# Пример SLO.md (Студенческая работа)

## Целевые показатели уровня обслуживания для Orders API

### Контекст

Orders API — это критически важный сервис для управления заказами в электронной коммерции. На основе нагрузочного тестирования с 100 RPS в течение 10 минут мы установили базовые показатели производительности и определили целевые показатели уровня обслуживания, которые балансируют надежность и скорость разработки.

### Индикаторы уровня обслуживания (SLI)

#### 1. Латентность запросов (p95)

**Определение**: 95-й процентиль времени выполнения HTTP-запросов для успешных ответов (коды состояния 2xx/3xx).

**PromQL запрос**:
```promql
histogram_quantile(0.95,
  sum by (le) (
    rate(http_request_duration_seconds_bucket{
      namespace="lab1",
      status_code=~"2..|3.."
    }[5m])
  )
) * 1000
```

**Обоснование**: Мы исключаем ошибки 4xx, поскольку они часто представляют клиентские ошибки с быстрыми путями отказа. Только успешные запросы отражают истинный пользовательский опыт по латентности.

#### 2. Частота ошибок

**Определение**: Отношение серверных ошибок (5xx) к общему количеству валидных запросов.

**PromQL запрос**:
```promql
(
  sum(rate(http_requests_total{namespace="lab1", status_code=~"5.."}[5m]))
  /
  sum(rate(http_requests_total{namespace="lab1", status_code=~"2..|3..|4..|5.."}[5m]))
) or vector(0)
```

**Обоснование**: Мы фокусируемся на ошибках 5xx, поскольку они указывают на отказы сервиса. Клиентские ошибки (4xx) исключаются, за исключением 429 (лимит скорости) и 503 (сервис недоступен), если они появляются.

### Базовая производительность

На основе нагрузочного тестирования при 100 RPS в течение 10 минут (60,147 запросов всего):

| Метрика | Значение |
|---------|----------|
| p50 Latency | 28.3 ms |
| p95 Latency | 87.2 ms |
| p99 Latency | 512.7 ms |
| Error Rate | 0.19% |
| Success Rate | 99.81% |

### Целевые показатели уровня обслуживания

#### SLO по латентности
**Цель**: p95 латентность < 120 ms за скользящий период 30 дней

**Обоснование**: 
- Базовое значение p95 составляет 87.2 ms
- Добавлен запас 37.6% (32.8 ms) для учета:
  - Ожидаемого добавления новых функций
  - Роста трафика
  - Небольших вариаций инфраструктуры
- 120 ms обеспечивает хороший пользовательский опыт для клиентов API

#### SLO по доступности
**Цель**: Частота ошибок ≤ 0.5% (99.5% доступности) за скользящий период 30 дней

**Обоснование**:
- Базовая частота ошибок составляет 0.19%
- Запас в 2.6x позволяет учесть:
  - Временные ошибки, связанные с развертыванием
  - Отказы зависимостей
  - Обслуживание инфраструктуры
- Более агрессивная цель не обоснована до получения данных о влиянии на бизнес

### Расчет бюджета ошибок

**Оценка месячного объема запросов**:
- Наблюдаемое: 100 RPS во время теста
- Коэффициент масштабирования: 3x (учет пиковых часов и роста)
- Оценка для продакшена: 300 RPS в среднем
- Месячные запросы: 300 × 30 × 24 × 3600 = 777,600,000 запросов

**Бюджет ошибок**:
- Допустимая частота ошибок: 0.5%
- Бюджет ошибок в запросах: 777,600,000 × 0.005 = 3,888,000 ошибок/месяц
- Бюджет ошибок по времени: 3,888,000 / (300 × 60) = 216 минут/месяц

Это означает, что мы можем выдержать примерно 216 минут полного простоя в месяц, или 3.88M неудачных запросов, распределенных в течение месяца.

### Мониторинг и контроль

- Соответствие SLO будет проверяться еженедельно
- При потреблении бюджета ошибок >50% к 15 числу месяца вводится заморозка развертываний
- Алерты дашборда срабатывают когда:
  - p95 латентность >120ms в течение 5 последовательных минут
  - Частота ошибок >0.5% в течение 5 последовательных минут

### Журнал изменений

| Дата | Изменение | Причина |
|------|-----------|---------|
| 2024-09-15 | Первоначальное определение SLO | Начало курса |

---

# Пример assumptions.txt

## Предположения нагрузочного тестирования

1. **Коэффициент масштабирования: 3x**
   - Тестовая среда: 100 RPS
   - Оценка для продакшена: 300 RPS в среднем
   - Обоснование: Позволяет учесть 2x пиковый трафик + 50% запас для роста

2. **Паттерн трафика**
   - Предполагается круглосуточная работа (глобальная электронная коммерция)
   - Не моделируются значительные различия день/ночь
   - Недельные паттерны не учитываются (выходные против будних дней)

3. **Использование бюджета ошибок**
   - Предполагается линейное потребление
   - Нет резерва для сезонных пиков (Черная пятница и т.д.)
   - Ошибки развертывания оцениваются в 0.1% на развертывание

4. **Предположения об инфраструктуре**
   - Развертывание в одном регионе
   - Нет CDN или слоя кэширования
   - Kubernetes автомасштабирование включено, но не тестировалось

5. **Будущие соображения**
   - Мультирегиональное развертывание потребует отдельных региональных SLO
   - Масштабирование БД может потребовать корректировки SLO по латентности
   - Интеграция с платежами потребует более строгого SLO по частоте ошибок

---

# Пример k6_summary.txt

```
     ✓ Get all orders - status is 200
     ✓ Get all orders - has orders
     ✓ Get order - status is 200 or 404
     ✓ Create order - status is 201
     ✓ Create order - has order ID
     ✓ Update order - status is 200 or 404
     ✓ Delete order - status is 204 or 404

     checks.........................: 99.89%  ✓ 120234      ✗ 131
     data_received..................: 142 MB  230 kB/s
     data_sent......................: 31 MB   50 kB/s
     errors.........................: 0.19%   ✓ 114         ✗ 60033
     http_req_blocked...............: avg=2.1µs    min=1µs      med=2µs      max=1.82ms   p(90)=3µs      p(95)=3µs
     http_req_connecting............: avg=45ns     min=0s       med=0s       max=412µs    p(90)=0s       p(95)=0s
     http_req_duration..............: avg=42.31ms  min=10.12ms  med=28.34ms  max=587.23ms p(90)=65.43ms  p(95)=87.21ms
       { expected_response:true }...: avg=41.92ms  min=10.12ms  med=28.26ms  max=542.18ms p(90)=64.89ms  p(95)=86.41ms
     http_req_failed................: 0.19%   ✓ 114         ✗ 60033
     http_req_receiving.............: avg=48.23µs  min=12µs     med=42µs     max=2.14ms   p(90)=78µs     p(95)=97µs
     http_req_sending...............: avg=12.45µs  min=4µs      med=10µs     max=824µs    p(90)=17µs     p(95)=22µs
     http_req_tls_handshaking.......: avg=0s       min=0s       med=0s       max=0s       p(90)=0s       p(95)=0s
     http_req_waiting...............: avg=42.25ms  min=10.09ms  med=28.28ms  max=587.17ms p(90)=65.34ms  p(95)=87.11ms
     http_reqs......................: 60147   97.239862/s
     iteration_duration.............: avg=1.04s    min=1.01s    med=1.03s    max=1.59s    p(90)=1.07s    p(95)=1.09s
     iterations.....................: 60147   97.239862/s
     vus............................: 100     min=100       max=100
     vus_max........................: 100     min=100       max=100

running (10m18.6s), 000/100 VUs, 60147 complete and 0 interrupted iterations
```

---

# Пример Git Commit

```bash
git add SLO.md assumptions.txt k6_summary.txt grafana/slo_dashboard.json docs/slo_dashboard.png
git commit -m "Lab1: базовые SLI+SLO показатели

- Определены SLI по латентности p95 (<120ms) и частоте ошибок (≤0.5%)
- Базовые показатели: p95=87.2ms, частота ошибок=0.19%
- Месячный бюджет ошибок: 3.88M запросов или 216 минут
- Добавлен дашборд Grafana с линиями порогов SLO
- Нагрузочное тестирование: 100 RPS в течение 10 минут, 60,147 запросов всего"

git push origin main
```